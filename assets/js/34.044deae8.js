(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{824:function(e,a,s){"use strict";s.r(a);var n=s(115),t=Object(n.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",[e._v("webpack 快问快答")]),e._v(" "),s("blockquote",[s("p",[e._v("参考或摘录文章：")]),e._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s/Rl0Zo4o0CP-BhK2ci56CgQ",target:"_blank",rel:"noopener noreferrer"}},[e._v("非常详细的解答了5个webpack疑问"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://kaiwu.lagou.com/course/courseInfo.htm?courseId=584#/content",target:"_blank",rel:"noopener noreferrer"}},[e._v("前端基础建设与架构 30 将"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://kaiwu.lagou.com/course/courseInfo.htm?courseId=416#/content",target:"_blank",rel:"noopener noreferrer"}},[e._v("前端工程化精讲"),s("OutboundLink")],1)])])]),e._v(" "),s("h2",{attrs:{id:"module，chunk-和-bundle-的区别？"}},[e._v("module，chunk 和 bundle 的区别？ "),s("a",{staticClass:"header-anchor",attrs:{href:"#module，chunk-和-bundle-的区别？"}},[e._v("#")])]),e._v(" "),s("p",[s("code",[e._v("module")]),e._v("，"),s("code",[e._v("chunk")]),e._v("，"),s("code",[e._v("bundle")]),e._v(" 就是同一份逻辑代码在不同转换场景下取的三个名字：我们直接写出来的是 module，webpack 处理时是 chunk，最后生成浏览器可以直接运行的是 bundle。")]),e._v(" "),s("p",[s("img",{attrs:{src:"webpack-chunk.webp",alt:"webpack-chunk"}})]),e._v(" "),s("p",[e._v("如上图：")]),e._v(" "),s("ol",[s("li",[e._v("我们手写下的一个个文件，无论是 ESM 还是 commonJS 或者 AMD，它们都是 "),s("code",[e._v("module")]),e._v("；")]),e._v(" "),s("li",[e._v("我们写的 module 源文件传到 webpack 进行打包时，webpack 会根据文件引用关系生成 "),s("code",[e._v("chunk")]),e._v(" 文件，默认的 chunk 数量实际上是由你的入口文件数量决定的（每一个入口点都是一个 chunk group，在不考虑分包的情况下，一个 chunk group 中只有一个 chunk），但是如果你配置动态加载或者提取公共包的话，也会生成新的 chunk；")]),e._v(" "),s("li",[e._v("webpack 处理好 chunk 文件后，最后会输出 "),s("code",[e._v("bundle")]),e._v(" 文件，这个 bundle 文件包含了经过加载和编译的最终源文件，可以在浏览器中运行。")])]),e._v(" "),s("h2",{attrs:{id:"filename-和-chunkfilename-区别？"}},[e._v("filename 和 chunkFilename 区别？ "),s("a",{staticClass:"header-anchor",attrs:{href:"#filename-和-chunkfilename-区别？"}},[e._v("#")])]),e._v(" "),s("ol",[s("li",[s("code",[e._v("filename")]),e._v(" 是指列在 "),s("code",[e._v("entry")]),e._v(" 中，打包后输出文件的名称：")])]),e._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[e._v("enrty"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  index"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'../src/index.js'")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\noutput"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  filename"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'[name].min.js'")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// index.min.js")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("ol",{attrs:{start:"2"}},[s("li",[s("code",[e._v("chunkFilename")]),e._v(" 就是未列在 "),s("code",[e._v("entry")]),e._v(" 中，缺又需要打包出来的文件（"),s("strong",[e._v("动态加载或者提取公共包后生成的 chunk")]),e._v("）名称，如果 chunkFilename 未指定（如 "),s("code",[e._v("output.chunkFilename")]),e._v("）,默认以 chunk 文件的 id 作为文件名。")])]),e._v(" "),s("h2",{attrs:{id:"webpackprefetch、webpackpreload-和-webpackchunkname-是干什么的？"}},[e._v("webpackPrefetch、webpackPreload 和 webpackChunkName 是干什么的？ "),s("a",{staticClass:"header-anchor",attrs:{href:"#webpackprefetch、webpackpreload-和-webpackchunkname-是干什么的？"}},[e._v("#")])]),e._v(" "),s("p",[e._v("这几个名词都是 webpack 的"),s("a",{attrs:{href:"https://webpack.docschina.org/api/module-methods/#magic-comments",target:"_blank",rel:"noopener noreferrer"}},[e._v("魔法注释"),s("OutboundLink")],1),e._v("，可以组合使用:")]),e._v(" "),s("ol",[s("li",[s("code",[e._v("webpackChunkName")]),e._v("：在 import 里以注释形式为新 chunk 文件命名，这样将动态加载生成的 新 chunk 命名为 "),s("code",[e._v("[my-chunk-name].js")]),e._v(" 而不是 "),s("code",[e._v("[id].js")]),e._v("。")]),e._v(" "),s("li",[s("code",[e._v("webpackPrefetch")]),e._v("(预拉取)会在浏览器闲置时下载对应的 chunk。")]),e._v(" "),s("li",[s("code",[e._v("webpackPreload")]),e._v("(预加载)会在父 chunk 加载时并行下载对应的 chunk。")])]),e._v(" "),s("h2",{attrs:{id:"hash、chunkhash、contenthash-有什么不同？"}},[e._v("hash、chunkhash、contenthash 有什么不同？ "),s("a",{staticClass:"header-anchor",attrs:{href:"#hash、chunkhash、contenthash-有什么不同？"}},[e._v("#")])]),e._v(" "),s("ol",[s("li",[s("code",[e._v("hash:")]),e._v(" 同一次构建过程中生成的 hash 是一样的，每一次构建后生成的哈希值都不一样，即使文件内容压根没有改变；")]),e._v(" "),s("li",[s("code",[e._v("chunkhash:")]),e._v(" 根据入口文件进行依赖解析，同一 chunk 内的文件 hash 一样；")]),e._v(" "),s("li",[s("code",[e._v("contenthash:")]),e._v(" 根据文件内容，生成 hash 值。")])]),e._v(" "),s("p",[e._v("具体可参考文章"),s("a",{attrs:{href:"https://juejin.cn/post/6844903942384517127",target:"_blank",rel:"noopener noreferrer"}},[e._v("从源码看 webpack 的 hash 策略"),s("OutboundLink")],1)]),e._v(" "),s("h2",{attrs:{id:"webpack-中的-sideeffects"}},[e._v("Webpack 中的 sideEffects "),s("a",{staticClass:"header-anchor",attrs:{href:"#webpack-中的-sideeffects"}},[e._v("#")])]),e._v(" "),s("p",[e._v("webpack v4 新增了 "),s("code",[e._v("sideEffects")]),e._v(" 特性，为 tree-shaking 提供更大的优化空间。通过在 package.json 中加入 "),s("code",[e._v("sideEffects")]),e._v(" 属性来表明模块是否包含 "),s("code",[e._v("sideEffects(副作用)")]),e._v(" 。")]),e._v(" "),s("p",[e._v("如果所有代码都不包含副作用，可以将 "),s("code",[e._v("sideEffects")]),e._v(" 置为 "),s("code",[e._v("false")]),e._v(" ，来告知 webpack ，它可以安全地删除未用到的 "),s("code",[e._v("export")]),e._v(" 导出。")]),e._v(" "),s("p",[s("code",[e._v("sideEffects")]),e._v(" 值可以为一个数组，值为包含副作用的代码文件，任何导入的文件都会受到 tree shaking 的影响，这意味着如果在项目中使用类似 css-loader 并导入 css 文件，则需将其添加到 "),s("code",[e._v("sideEffects")]),e._v(" 列表中，以免在生产模式中无意中将它删除，如 "),s("code",[e._v("antd")]),e._v(" 的 "),s("code",[e._v("sideEffects")]),e._v(" 为：")]),e._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[e._v('"sideEffects"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"dist/*"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"es/**/style/*"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"lib/**/style/*"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"*.less"')]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("p",[e._v("对于 Webpack 工具，开发者可以在 "),s("a",{attrs:{href:"https://github.com/webpack/webpack/issues/6065#issuecomment-351060570",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("module.rule")]),s("OutboundLink")],1),e._v(" 配置中声明副作用模块。")]),e._v(" "),s("h2",{attrs:{id:"babel-和-tree-shaking"}},[e._v("Babel 和 Tree Shaking "),s("a",{staticClass:"header-anchor",attrs:{href:"#babel-和-tree-shaking"}},[e._v("#")])]),e._v(" "),s("p",[s("code",[e._v("Tree Shaking")]),e._v(" 依托于 ESM ，而如果使用 "),s("code",[e._v("Babel")]),e._v(" 对代码进行编译，"),s("code",[e._v("Babel")]),e._v(" 默认会将 ESM 编译为 CommonJS 模块规范，因此需要配置 "),s("code",[e._v("Babel")]),e._v(" 对于模块化的编译降级，具体配置项在 "),s("a",{attrs:{href:"https://babeljs.io/docs/en/babel-preset-env#modules",target:"_blank",rel:"noopener noreferrer"}},[e._v("babel-preset-env#modules"),s("OutboundLink")],1),e._v(" 中。")]),e._v(" "),s("p",[e._v("某些工具链上的工具是依赖 CommonJS 规范的代码的，比如 "),s("code",[e._v("Jest")]),e._v("，"),s("code",[e._v("Jest")]),e._v(" 是基于 Nodejs 开发的，运行在 Node.js 环境，因此使用 "),s("code",[e._v("Jest")]),e._v(" 进行测试时，需要模块符合 CommonJS 规范，因此需要"),s("strong",[e._v("根据不同的环境，采用不同的 "),s("code",[e._v("Babel")]),e._v(" 配置")]),e._v("。\n在生产环境，配置：")]),e._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[e._v("production"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  presets"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'@babel/preset-env'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        modules"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br")])]),s("p",[e._v("在测试环境：")]),e._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[e._v("test"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  presets"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'@babel/preset-env'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        modules"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'commonjs'")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br")])]),s("h2",{attrs:{id:"webpack-和-tree-shaking"}},[e._v("Webpack 和 Tree Shaking "),s("a",{staticClass:"header-anchor",attrs:{href:"#webpack-和-tree-shaking"}},[e._v("#")])]),e._v(" "),s("p",[e._v("Webpack 4.0 以上版本在 mode 为 production 时，会自动开启 "),s("code",[e._v("Tree Shaking")]),e._v(" 能力。\nWebpack 真正执行模块去除，是依赖了 "),s("code",[e._v("TerserPlugin")]),e._v("、"),s("code",[e._v("UglifyJS")]),e._v(" 等压缩插件。Webpack 负责对模块进行分析和标记，压缩插件负责根据标记结果，进行代码删除。Webpack 在分析时，有三类标记：")]),e._v(" "),s("ol",[s("li",[s("code",[e._v("harmony export")]),e._v("：被使用过的 "),s("code",[e._v("export")]),e._v(" 会被标记为 "),s("code",[e._v("harmony export")]),e._v("；")]),e._v(" "),s("li",[s("code",[e._v("unused harmony export")]),e._v("：没被使用过的 "),s("code",[e._v("export")]),e._v(" 会被标记为 "),s("code",[e._v("unused harmony export")]),e._v("；")]),e._v(" "),s("li",[s("code",[e._v("harmony import")]),e._v("：所有 "),s("code",[e._v("import")]),e._v(" 会被标记为 "),s("code",[e._v("harmony import")]),e._v("。")])]),e._v(" "),s("h2",{attrs:{id:"source-map-中-eval、cheap、inline-和-module-是什么意思？"}},[e._v("source map 中 eval、cheap、inline 和 module 是什么意思？ "),s("a",{staticClass:"header-anchor",attrs:{href:"#source-map-中-eval、cheap、inline-和-module-是什么意思？"}},[e._v("#")])]),e._v(" "),s("p",[e._v("source map 就是一份源码和转换后代码的映射文件。\n在 webpack 中，通过设置 devtool 来选择 source map 的预设类型，文档共有"),s("a",{attrs:{href:"https://webpack.js.org/configuration/devtool/#devtool",target:"_blank",rel:"noopener noreferrer"}},[e._v("20 余种预设"),s("OutboundLink")],1),e._v("，这些预设基本都是 "),s("code",[e._v("eval")]),e._v("、"),s("code",[e._v("cheap")]),e._v("、"),s("code",[e._v("module")]),e._v("、"),s("code",[e._v("inline")]),e._v("、"),s("code",[e._v("hidden")]),e._v("、"),s("code",[e._v("nosource")]),e._v("、"),s("code",[e._v("source-map")]),e._v(" 等关键字的组合：")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("false")]),e._v("：不开启 source map 功能。")]),e._v(" "),s("li",[s("code",[e._v("eval")]),e._v("：使用 "),s("a",{attrs:{href:"https://github.com/webpack/webpack/blob/master/lib/EvalDevToolModulePlugin.js",target:"_blank",rel:"noopener noreferrer"}},[e._v("EvalDevToolModulePlugin"),s("OutboundLink")],1),e._v(" 作为 source map 的处理插件。模块产物代码通过 eval() 封装，模块代码后添加 sourceURL=webpack:/// + 模块引用路径，不生成 source map 内容。")]),e._v(" "),s("li",[s("code",[e._v("cheap")]),e._v(": map 映射只显示行不显示列，忽略源自 loader 的 source map。")]),e._v(" "),s("li",[s("code",[e._v("inline")]),e._v(": 映射文件以 base64 格式编码，加在 bundle 文件最后，不产生独立的 map 文件。")]),e._v(" "),s("li",[s("code",[e._v("module")]),e._v(": 增加对 loader source map 和第三方模块的映射。")])]),e._v(" "),s("p",[e._v("常用配置：")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("source-map")]),e._v("："),s("code",[e._v("source-map")]),e._v(" 是最大而全的，会生成独立的 map 文件，会显示报错的行列信息。")]),e._v(" "),s("li",[s("code",[e._v("cheap-source-map")]),e._v("：会生成独立的 map 文件，不会产生列映射。")]),e._v(" "),s("li",[s("code",[e._v("eval-source-map")]),e._v("：会以 eval() 函数打包运行模块，不产生独立的 map 文件，会显示报错的行列信息。")]),e._v(" "),s("li",[s("code",[e._v("inline-source-map")]),e._v("：映射文件以 base64 格式编码，加在 bundle 文件最后，不产生独立的 map 文件。")]),e._v(" "),s("li",[s("code",[e._v("cheap-module-eval-source-map")]),e._v("："),s("strong",[e._v("开发环境推荐使用")]),e._v("，在构建速度报错提醒上做了比较好的均衡。")]),e._v(" "),s("li",[s("code",[e._v("cheap-module-source-map")]),e._v(": 一般来说，生产环境是不配 source map 的，如果想捕捉线上的代码报错，可以用这个。")])])])}),[],!1,null,null,null);a.default=t.exports}}]);