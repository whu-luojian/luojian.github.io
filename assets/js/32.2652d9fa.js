(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{834:function(e,t,a){"use strict";a.r(t);var s=a(115),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",[e._v("vue3 响应式原理")]),e._v(" "),a("h2",{attrs:{id:"概览"}},[e._v("概览 "),a("a",{staticClass:"header-anchor",attrs:{href:"#概览"}},[e._v("#")])]),e._v(" "),a("p",[a("code",[e._v("vue3")]),e._v(" 响应式系统的源码在仓库 "),a("a",{attrs:{href:"https://github.com/vuejs/vue-next",target:"_blank",rel:"noopener noreferrer"}},[e._v("vue-next"),a("OutboundLink")],1),e._v(" 的 "),a("code",[e._v("packages/reactivity")]),e._v(" 中，源码目录结构如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("packages/reactivity\n|-- src\n\t|-- baseHandlers.ts\t\t\t// Proxy handler，针对常规对象（Array，Object）\n\t|-- collectionHandlers.ts\t// Proxy handler，针对 Set、Map、WeakMap、WeakMap 集合对象\n\t|-- computed.ts\t\t\t\t// 计算属性，同 vue2 的 computed\n\t|-- effect.ts\t\t\t\t// 依赖收集，响应式处理\n\t|-- index.ts\t\t\t\t// 入口文件，导出 API\n\t|-- operations.ts\t\t\t// 触发依赖收集及更新的数据操作类型枚举\n\t|-- reactive.ts\t\t\t\t// 针对对象的响应式代理\n\t|-- ref.ts\t\t\t\t\t// 针对基本数据类型的响应式代理\n|-- README.md\t\t\t\t\t// readme 文档\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br")])]),a("p",[e._v("看一眼 "),a("code",[e._v("README")]),e._v(" 文档：")]),e._v(" "),a("ul",[a("li",[e._v("包 "),a("code",[e._v("@vue/reactivity")]),e._v(" 会被内嵌到面向用户的渲染器（例如："),a("code",[e._v("@vue/runtime-core")]),e._v("）中使用 ，也可单独使用")]),e._v(" "),a("li",[e._v("除了 "),a("code",[e._v("Object")]),e._v(" 、"),a("code",[e._v("Array")]),e._v("、"),a("code",[e._v("Map")]),e._v("、"),a("code",[e._v("WeakMap")]),e._v("、"),a("code",[e._v("Set")]),e._v("、"),a("code",[e._v("WeakSet")]),e._v(" 之外，其他 "),a("code",[e._v("JavaScript")]),e._v(" "),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects",target:"_blank",rel:"noopener noreferrer"}},[e._v("内建对象"),a("OutboundLink")],1),e._v(" （比如："),a("code",[e._v("Date")]),e._v("、"),a("code",[e._v("RegExp")]),e._v("）不能被响应式代理")])]),e._v(" "),a("p",[a("code",[e._v("vue3")]),e._v(" 响应式系统 API 可参看"),a("RouterLink",{attrs:{to:"/blog/[https://composition-api.vuejs.org/zh/api.html#响应式系统-api](https://composition-api.vuejs.org/zh/api.html#响应式系统-api)"}},[e._v("官方rfc文档")]),e._v(" ，各API使用方式可见："),a("a",{attrs:{href:"https://github.com/whu-luojian/vite-vue3",target:"_blank",rel:"noopener noreferrer"}},[e._v("demo"),a("OutboundLink")],1),e._v("。")],1),e._v(" "),a("p",[e._v("主要有四个关键的API:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("reactive")]),e._v("：针对对象的响应式代理，等同于 "),a("code",[e._v("vue 2.x")]),e._v(" 的 "),a("a",{attrs:{href:"https://cn.vuejs.org/v2/api/#Vue-observable",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("Vue.observable")]),a("OutboundLink")],1),e._v("，作用等同于 "),a("code",[e._v("vue 2.x")]),e._v(" 的 "),a("code",[e._v("data")]),e._v(" 选项")]),e._v(" "),a("li",[a("code",[e._v("ref")]),e._v("：针对基本类型的响应式代理，返回一个具有 "),a("code",[e._v(".value")]),e._v(" 属性的响应式包装对象")]),e._v(" "),a("li",[a("code",[e._v("computed")]),e._v("：计算属性，等同于 "),a("code",[e._v("vue 2.x")]),e._v(" 的 "),a("code",[e._v("computed")]),e._v(" 选项")]),e._v(" "),a("li",[a("code",[e._v("effect")]),e._v("：用来进行依赖收集的API，作用等同于  "),a("code",[e._v("vue 2.x")]),e._v(" 的 "),a("code",[e._v("watcher")]),e._v("，"),a("code",[e._v("computed")]),e._v("、"),a("code",[e._v("watch")]),e._v("、"),a("code",[e._v("watchEffect")]),e._v(" API 都是基于 "),a("code",[e._v("effect")]),e._v(" 实现的")])]),e._v(" "),a("h2",{attrs:{id:"reactive"}},[e._v("reactive "),a("a",{staticClass:"header-anchor",attrs:{href:"#reactive"}},[e._v("#")])]),e._v(" "),a("h2",{attrs:{id:"ref"}},[e._v("ref "),a("a",{staticClass:"header-anchor",attrs:{href:"#ref"}},[e._v("#")])]),e._v(" "),a("p",[e._v("接受一个参数值并返回一个响应式且可改变的 ref 对象。ref 对象拥有一个指向内部值的单一属性 "),a("code",[e._v(".value")]),e._v("。")]),e._v(" "),a("p",[a("code",[e._v("ref")]),e._v(" 类型定义：")]),e._v(" "),a("div",{staticClass:"language-tsx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("declare")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" RefSymbol"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" unique "),a("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("symbol")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("interface")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Ref")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("T")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("any")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("RefSymbol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 标识是否是 ref")]),e._v("\n    value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("T")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ref 的值")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])])])}),[],!1,null,null,null);t.default=r.exports}}]);