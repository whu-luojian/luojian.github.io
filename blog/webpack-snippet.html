<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>webpack 快问快答 | 前端杂货铺</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/me.png">
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.86f419de.css" as="style"><link rel="preload" href="/assets/js/app.5e7b4428.js" as="script"><link rel="preload" href="/assets/js/2.3b4e6f05.js" as="script"><link rel="preload" href="/assets/js/33.aa233a0d.js" as="script"><link rel="prefetch" href="/assets/js/10.57c32aac.js"><link rel="prefetch" href="/assets/js/11.2ae49af2.js"><link rel="prefetch" href="/assets/js/12.d6bb1eef.js"><link rel="prefetch" href="/assets/js/13.8610bd96.js"><link rel="prefetch" href="/assets/js/14.ac07e20b.js"><link rel="prefetch" href="/assets/js/15.4b0c4fb6.js"><link rel="prefetch" href="/assets/js/16.36e3b0a2.js"><link rel="prefetch" href="/assets/js/17.ec737159.js"><link rel="prefetch" href="/assets/js/18.c1f75541.js"><link rel="prefetch" href="/assets/js/19.4cfccaf1.js"><link rel="prefetch" href="/assets/js/20.cb982318.js"><link rel="prefetch" href="/assets/js/21.5bbe1196.js"><link rel="prefetch" href="/assets/js/22.08d3f620.js"><link rel="prefetch" href="/assets/js/23.29130483.js"><link rel="prefetch" href="/assets/js/24.8c44f016.js"><link rel="prefetch" href="/assets/js/25.5e9e9ae0.js"><link rel="prefetch" href="/assets/js/26.5b14ca65.js"><link rel="prefetch" href="/assets/js/27.b91960a1.js"><link rel="prefetch" href="/assets/js/28.caccfd5a.js"><link rel="prefetch" href="/assets/js/29.a442da8a.js"><link rel="prefetch" href="/assets/js/3.6ea70b53.js"><link rel="prefetch" href="/assets/js/30.d129ca95.js"><link rel="prefetch" href="/assets/js/31.d9b9c221.js"><link rel="prefetch" href="/assets/js/32.b08c8165.js"><link rel="prefetch" href="/assets/js/34.fcb8a6fe.js"><link rel="prefetch" href="/assets/js/35.d66c2ba0.js"><link rel="prefetch" href="/assets/js/36.248fbb88.js"><link rel="prefetch" href="/assets/js/37.f87965d7.js"><link rel="prefetch" href="/assets/js/38.73fa5111.js"><link rel="prefetch" href="/assets/js/39.2d8ee785.js"><link rel="prefetch" href="/assets/js/4.8d3c77a5.js"><link rel="prefetch" href="/assets/js/40.e154d057.js"><link rel="prefetch" href="/assets/js/41.c2d393c4.js"><link rel="prefetch" href="/assets/js/42.5ef96d61.js"><link rel="prefetch" href="/assets/js/43.5b7a4356.js"><link rel="prefetch" href="/assets/js/44.259a3d35.js"><link rel="prefetch" href="/assets/js/5.34897474.js"><link rel="prefetch" href="/assets/js/6.323f9909.js"><link rel="prefetch" href="/assets/js/7.4fdc54b4.js"><link rel="prefetch" href="/assets/js/8.ad92a02b.js"><link rel="prefetch" href="/assets/js/9.81db993f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.86f419de.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-579a05ae><header class="navbar" data-v-579a05ae><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active home-link"><img src="/me.png" alt="前端杂货铺" class="logo"> <span class="site-name">前端杂货铺</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div placeholder="搜索..." class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item ant-menu-item-selected"><a href="/blog/" class="router-link-active">
          博客
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/book/">
          阅读
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/interview/">
          面试
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          工具库
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <a href="https://github.com/whu-luojian/blog" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <div class="main-wrapper" data-v-579a05ae><div class="ant-row" data-v-579a05ae><div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4" data-v-579a05ae><div style="width:100%;" data-v-579a05ae><div><aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/linux-command.html" class="sidebar-link">Linux 常用命令</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Git</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/git-version-control.html" class="sidebar-link">软件开发中的版本控制</a></li><li><a href="/blog/git-account-config.html" class="sidebar-link">Git 多账户配置</a></li><li><a href="/blog/git-advance.html" class="sidebar-link">Git 进阶</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTML</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/html-you-not-know.html" class="sidebar-link">你不知道的HTML</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/css-cup-and-wing.html" class="sidebar-link">圣杯布局和双飞翼布局</a></li><li><a href="/blog/css-fc.html" class="sidebar-link">CSS 格式化上下文</a></li><li><a href="/blog/css-compatibility.html" class="sidebar-link">CSS 浏览器兼容性</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/js-execution.html" class="sidebar-link">JavaScript 执行原理</a></li><li><a href="/blog/js-object-oriented.html" class="sidebar-link">JavaScript 面向对象：原型和继承</a></li><li><a href="/blog/tail-recursion.html" class="sidebar-link">尾调用和尾递归</a></li><li><a href="/blog/functional-programming.html" class="sidebar-link">函数式编程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/browser-frontend-cache.html" class="sidebar-link">一文读懂前端缓存</a></li><li><a href="/blog/browser-fps.html" class="sidebar-link">你真的了解 FPS 吗</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/vue-nextTick.html" class="sidebar-link">vue nextTick 引发的思考</a></li><li><a href="/blog/vue-vuex.html" class="sidebar-link">Vuex 源码解析</a></li><li><a href="/blog/vue-vue3.html" class="sidebar-link">vue 3 &amp; vite 介绍</a></li><li><a href="/blog/vue-tracker.html" class="sidebar-link">vue web端埋点方案优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>工程化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/webpack.html" class="sidebar-link">webpack 运行机制和 webpack 5</a></li><li><a href="/blog/webpack-snippet.html" aria-current="page" class="active sidebar-link">webpack 快问快答</a></li><li><a href="/blog/npm.html" class="sidebar-link">npm 安装机制</a></li><li><a href="/blog/yarn.html" class="sidebar-link">Yarn 安装机制</a></li><li><a href="/blog/core-js.html" class="sidebar-link">core-js &amp; polyfill</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其它</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/other-navigation.html" class="sidebar-link">网站导航</a></li><li><a href="/blog/wonderful-article.html" class="sidebar-link">优秀文章导航</a></li><li><a href="/blog/other-daily.html" class="sidebar-link">日常小知识点</a></li></ul></section></li></ul> </aside></div></div></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20" data-v-579a05ae><main class="page" data-v-579a05ae> <div><div><div class="table-of-contents-default"><ul class="toc"><li title="module，chunk 和 bundle 的区别？"><a href="#module，chunk-和-bundle-的区别？" class="toc-anchor">module，chunk 和 bundle 的区别？</a></li><li title="filename 和 chunkFilename 区别？"><a href="#filename-和-chunkfilename-区别？" class="toc-anchor">filename 和 chunkFilename 区别？</a></li><li title="webpackPrefetch、webpackPreload 和 webpackChunkName 是干什么的？"><a href="#webpackprefetch、webpackpreload-和-webpackchunkname-是干什么的？" class="toc-anchor">webpackPrefetch、webpackPreload 和 webpackChunkName 是干什么的？</a></li><li title="hash、chunkhash、contenthash 有什么不同？"><a href="#hash、chunkhash、contenthash-有什么不同？" class="toc-anchor">hash、chunkhash、contenthash 有什么不同？</a></li><li title="Webpack 中的 sideEffects"><a href="#webpack-中的-sideeffects" class="toc-anchor">Webpack 中的 sideEffects</a></li><li title="Babel 和 Tree Shaking"><a href="#babel-和-tree-shaking" class="toc-anchor">Babel 和 Tree Shaking</a></li><li title="Webpack 和 Tree Shaking"><a href="#webpack-和-tree-shaking" class="toc-anchor">Webpack 和 Tree Shaking</a></li><li title="source map 中 eval、cheap、inline 和 module 是什么意思？"><a href="#source-map-中-eval、cheap、inline-和-module-是什么意思？" class="toc-anchor">source map 中 eval、cheap、inline 和 module 是什么意思？</a></li></ul></div></div></div> <div class="theme-antdesign-content content__default"><h1>webpack 快问快答</h1> <blockquote><p>参考或摘录文章：</p> <ol><li><a href="https://mp.weixin.qq.com/s/Rl0Zo4o0CP-BhK2ci56CgQ" target="_blank" rel="noopener noreferrer">非常详细的解答了5个webpack疑问<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=584#/content" target="_blank" rel="noopener noreferrer">前端基础建设与架构 30 将<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=416#/content" target="_blank" rel="noopener noreferrer">前端工程化精讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol></blockquote> <h2 id="module，chunk-和-bundle-的区别？">module，chunk 和 bundle 的区别？ <a href="#module，chunk-和-bundle-的区别？" class="header-anchor">#</a></h2> <p><code>module</code>，<code>chunk</code>，<code>bundle</code> 就是同一份逻辑代码在不同转换场景下取的三个名字：我们直接写出来的是 module，webpack 处理时是 chunk，最后生成浏览器可以直接运行的是 bundle。</p> <p><img src="webpack-chunk.webp" alt="webpack-chunk"></p> <p>如上图：</p> <ol><li>我们手写下的一个个文件，无论是 ESM 还是 commonJS 或者 AMD，它们都是 <code>module</code>；</li> <li>我们写的 module 源文件传到 webpack 进行打包时，webpack 会根据文件引用关系生成 <code>chunk</code> 文件，默认的 chunk 数量实际上是由你的入口文件数量决定的（每一个入口点都是一个 chunk group，在不考虑分包的情况下，一个 chunk group 中只有一个 chunk），但是如果你配置动态加载或者提取公共包的话，也会生成新的 chunk；</li> <li>webpack 处理好 chunk 文件后，最后会输出 <code>bundle</code> 文件，这个 bundle 文件包含了经过加载和编译的最终源文件，可以在浏览器中运行。</li></ol> <h2 id="filename-和-chunkfilename-区别？">filename 和 chunkFilename 区别？ <a href="#filename-和-chunkfilename-区别？" class="header-anchor">#</a></h2> <ol><li><code>filename</code> 是指列在 <code>entry</code> 中，打包后输出文件的名称：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>enrty<span class="token operator">:</span> <span class="token punctuation">{</span>
  index<span class="token operator">:</span> <span class="token string">'../src/index.js'</span>
<span class="token punctuation">}</span>
output<span class="token operator">:</span> <span class="token punctuation">{</span>
  filename<span class="token operator">:</span> <span class="token string">'[name].min.js'</span> <span class="token comment">// index.min.js</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li><code>chunkFilename</code> 就是未列在 <code>entry</code> 中，缺又需要打包出来的文件（<strong>动态加载或者提取公共包后生成的 chunk</strong>）名称，如果 chunkFilename 未指定（如 <code>output.chunkFilename</code>）,默认以 chunk 文件的 id 作为文件名。</li></ol> <h2 id="webpackprefetch、webpackpreload-和-webpackchunkname-是干什么的？">webpackPrefetch、webpackPreload 和 webpackChunkName 是干什么的？ <a href="#webpackprefetch、webpackpreload-和-webpackchunkname-是干什么的？" class="header-anchor">#</a></h2> <p>这几个名词都是 webpack 的<a href="https://webpack.docschina.org/api/module-methods/#magic-comments" target="_blank" rel="noopener noreferrer">魔法注释<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，可以组合使用:</p> <ol><li><code>webpackChunkName</code>：在 import 里以注释形式为新 chunk 文件命名，这样将动态加载生成的 新 chunk 命名为 <code>[my-chunk-name].js</code> 而不是 <code>[id].js</code>。</li> <li><code>webpackPrefetch</code>(预拉取)会在浏览器闲置时下载对应的 chunk。</li> <li><code>webpackPreload</code>(预加载)会在父 chunk 加载时并行下载对应的 chunk。</li></ol> <h2 id="hash、chunkhash、contenthash-有什么不同？">hash、chunkhash、contenthash 有什么不同？ <a href="#hash、chunkhash、contenthash-有什么不同？" class="header-anchor">#</a></h2> <ol><li><code>hash:</code> 同一次构建过程中生成的 hash 是一样的，每一次构建后生成的哈希值都不一样，即使文件内容压根没有改变；</li> <li><code>chunkhash:</code> 根据入口文件进行依赖解析，同一 chunk 内的文件 hash 一样；</li> <li><code>contenthash:</code> 根据文件内容，生成 hash 值。</li></ol> <p>具体可参考文章<a href="https://juejin.cn/post/6844903942384517127" target="_blank" rel="noopener noreferrer">从源码看 webpack 的 hash 策略<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="webpack-中的-sideeffects">Webpack 中的 sideEffects <a href="#webpack-中的-sideeffects" class="header-anchor">#</a></h2> <p>webpack v4 新增了 <code>sideEffects</code> 特性，为 tree-shaking 提供更大的优化空间。通过在 package.json 中加入 <code>sideEffects</code> 属性来表明模块是否包含 <code>sideEffects(副作用)</code> 。</p> <p>如果所有代码都不包含副作用，可以将 <code>sideEffects</code> 置为 <code>false</code> ，来告知 webpack ，它可以安全地删除未用到的 <code>export</code> 导出。</p> <p><code>sideEffects</code> 值可以为一个数组，值为包含副作用的代码文件，任何导入的文件都会受到 tree shaking 的影响，这意味着如果在项目中使用类似 css-loader 并导入 css 文件，则需将其添加到 <code>sideEffects</code> 列表中，以免在生产模式中无意中将它删除，如 <code>antd</code> 的 <code>sideEffects</code> 为：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;dist/*&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;es/**/style/*&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;lib/**/style/*&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;*.less&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>对于 Webpack 工具，开发者可以在 <a href="https://github.com/webpack/webpack/issues/6065#issuecomment-351060570" target="_blank" rel="noopener noreferrer"><code>module.rule</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 配置中声明副作用模块。</p> <h2 id="babel-和-tree-shaking">Babel 和 Tree Shaking <a href="#babel-和-tree-shaking" class="header-anchor">#</a></h2> <p><code>Tree Shaking</code> 依托于 ESM ，而如果使用 <code>Babel</code> 对代码进行编译，<code>Babel</code> 默认会将 ESM 编译为 CommonJS 模块规范，因此需要配置 <code>Babel</code> 对于模块化的编译降级，具体配置项在 <a href="https://babeljs.io/docs/en/babel-preset-env#modules" target="_blank" rel="noopener noreferrer">babel-preset-env#modules<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 中。</p> <p>某些工具链上的工具是依赖 CommonJS 规范的代码的，比如 <code>Jest</code>，<code>Jest</code> 是基于 Nodejs 开发的，运行在 Node.js 环境，因此使用 <code>Jest</code> 进行测试时，需要模块符合 CommonJS 规范，因此需要<strong>根据不同的环境，采用不同的 <code>Babel</code> 配置</strong>。
在生产环境，配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>production<span class="token operator">:</span> <span class="token punctuation">{</span>
  presets<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        modules<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在测试环境：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>test<span class="token operator">:</span> <span class="token punctuation">{</span>
  presets<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        modules<span class="token operator">:</span> <span class="token string">'commonjs'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="webpack-和-tree-shaking">Webpack 和 Tree Shaking <a href="#webpack-和-tree-shaking" class="header-anchor">#</a></h2> <p>Webpack 4.0 以上版本在 mode 为 production 时，会自动开启 <code>Tree Shaking</code> 能力。
Webpack 真正执行模块去除，是依赖了 <code>TerserPlugin</code>、<code>UglifyJS</code> 等压缩插件。Webpack 负责对模块进行分析和标记，压缩插件负责根据标记结果，进行代码删除。Webpack 在分析时，有三类标记：</p> <ol><li><code>harmony export</code>：被使用过的 <code>export</code> 会被标记为 <code>harmony export</code>；</li> <li><code>unused harmony export</code>：没被使用过的 <code>export</code> 会被标记为 <code>unused harmony export</code>；</li> <li><code>harmony import</code>：所有 <code>import</code> 会被标记为 <code>harmony import</code>。</li></ol> <h2 id="source-map-中-eval、cheap、inline-和-module-是什么意思？">source map 中 eval、cheap、inline 和 module 是什么意思？ <a href="#source-map-中-eval、cheap、inline-和-module-是什么意思？" class="header-anchor">#</a></h2> <p>source map 就是一份源码和转换后代码的映射文件。
在 webpack 中，通过设置 devtool 来选择 source map 的预设类型，文档共有<a href="https://webpack.js.org/configuration/devtool/#devtool" target="_blank" rel="noopener noreferrer">20 余种预设<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这些预设基本都是 <code>eval</code>、<code>cheap</code>、<code>module</code>、<code>inline</code>、<code>hidden</code>、<code>nosource</code>、<code>source-map</code> 等关键字的组合：</p> <ul><li><code>false</code>：不开启 source map 功能。</li> <li><code>eval</code>：使用 <a href="https://github.com/webpack/webpack/blob/master/lib/EvalDevToolModulePlugin.js" target="_blank" rel="noopener noreferrer">EvalDevToolModulePlugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 作为 source map 的处理插件。模块产物代码通过 eval() 封装，模块代码后添加 sourceURL=webpack:/// + 模块引用路径，不生成 source map 内容。</li> <li><code>cheap</code>: map 映射只显示行不显示列，忽略源自 loader 的 source map。</li> <li><code>inline</code>: 映射文件以 base64 格式编码，加在 bundle 文件最后，不产生独立的 map 文件。</li> <li><code>module</code>: 增加对 loader source map 和第三方模块的映射。</li></ul> <p>常用配置：</p> <ul><li><code>source-map</code>：<code>source-map</code> 是最大而全的，会生成独立的 map 文件，会显示报错的行列信息。</li> <li><code>cheap-source-map</code>：会生成独立的 map 文件，不会产生列映射。</li> <li><code>eval-source-map</code>：会以 eval() 函数打包运行模块，不产生独立的 map 文件，会显示报错的行列信息。</li> <li><code>inline-source-map</code>：映射文件以 base64 格式编码，加在 bundle 文件最后，不产生独立的 map 文件。</li> <li><code>cheap-module-eval-source-map</code>：<strong>开发环境推荐使用</strong>，在构建速度报错提醒上做了比较好的均衡。</li> <li><code>cheap-module-source-map</code>: 一般来说，生产环境是不配 source map 的，如果想捕捉线上的代码报错，可以用这个。</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/whu-luojian/blog/edit/master/docs/blog/webpack-snippet.md" target="_blank" rel="noopener noreferrer">本文源码地址</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">1/26/2021, 7:22:21 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blog/webpack.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        webpack 运行机制和 webpack 5
      </a></span> <span class="next"><a href="/blog/npm.html">
        npm 安装机制
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main></div></div></div> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5e7b4428.js" defer></script><script src="/assets/js/2.3b4e6f05.js" defer></script><script src="/assets/js/33.aa233a0d.js" defer></script>
  </body>
</html>
